"use strict";(self["webpackChunkgrpc_web_demo"]=self["webpackChunkgrpc_web_demo"]||[]).push([[276],{7276:function(e,t,s){s.r(t),s.d(t,{default:function(){return y}});var l=s(3396),a=s(7139);const i=e=>((0,l.dD)("data-v-89249bde"),e=e(),(0,l.Cn)(),e),o=(0,l.Uk)("isBefore"),n=(0,l.Uk)("isFinish"),c=(0,l.Uk)("isException"),u=(0,l.Uk)("isSuccess"),d=i((()=>(0,l._)("span",null,"true",-1))),h=i((()=>(0,l._)("span",null,"false",-1))),r=i((()=>(0,l._)("span",null,"true",-1))),m=i((()=>(0,l._)("span",null,"false",-1))),p=(0,l.Uk)("Cancel"),w=(0,l.Uk)("清除结果"),g=i((()=>(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"jobid"),(0,l._)("th",null,"resultid"),(0,l._)("th",null,"ts"),(0,l._)("th",null,"accessPoint"),(0,l._)("th",null,"className"),(0,l._)("th",null,"methodName"),(0,l._)("th",null,"cost"),(0,l._)("th",null,"value"),(0,l._)("th",null,"查看当前结果信息")])],-1))),b=(0,l.Uk)("查看结果"),f=(0,l.Uk)("重新查询"),M=i((()=>(0,l._)("h3",null,"value结果:(可以点击重新查询按钮反复筛选查看)",-1)));function R(e,t,s,i,R,x){const q=(0,l.up)("Input"),_=(0,l.up)("FormItem"),W=(0,l.up)("Col"),j=(0,l.up)("Row"),y=(0,l.up)("Radio"),C=(0,l.up)("RadioGroup"),E=(0,l.up)("i-switch"),v=(0,l.up)("Button"),V=(0,l.up)("Form"),I=(0,l.up)("Tree"),S=(0,l.up)("Tag"),O=(0,l.up)("Modal");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(V,{model:R.watchRequestModel,"label-width":150,style:{"margin-top":"20px","justify-content":"center"}},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"classPattern"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{modelValue:R.watchRequestModel.classPattern,"onUpdate:modelValue":t[0]||(t[0]=e=>R.watchRequestModel.classPattern=e),placeholder:"Enter className..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"methodPattern"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{modelValue:R.watchRequestModel.methodPattern,"onUpdate:modelValue":t[1]||(t[1]=e=>R.watchRequestModel.methodPattern=e),placeholder:"Enter metheName..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"express"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{modelValue:R.watchRequestModel.express,"onUpdate:modelValue":t[2]||(t[2]=e=>R.watchRequestModel.express=e),placeholder:"Enter express..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"conditionExpress"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{modelValue:R.watchRequestModel.conditionExpress,"onUpdate:modelValue":t[3]||(t[3]=e=>R.watchRequestModel.conditionExpress=e),placeholder:"Enter conditionExpress..."},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})]),(0,l._)("div",null,[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{span:"8"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"situation"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{modelValue:R.watchRequestModel.situation,"onUpdate:modelValue":t[4]||(t[4]=e=>R.watchRequestModel.situation=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{label:"isBefore"},{default:(0,l.w5)((()=>[o])),_:1}),(0,l.Wm)(y,{label:"isFinish"},{default:(0,l.w5)((()=>[n])),_:1}),(0,l.Wm)(y,{label:"isException"},{default:(0,l.w5)((()=>[c])),_:1}),(0,l.Wm)(y,{label:"isSuccess"},{default:(0,l.w5)((()=>[u])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"expand"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{type:"number",modelValue:R.watchRequestModel.expand,"onUpdate:modelValue":t[5]||(t[5]=e=>R.watchRequestModel.expand=e),placeholder:"Enter expand..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"sizeLimit"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{type:"number",modelValue:R.watchRequestModel.sizeLimit,"onUpdate:modelValue":t[6]||(t[6]=e=>R.watchRequestModel.sizeLimit=e),placeholder:"Enter sizeLimit..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"4"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"isRegEx"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{modelValue:R.watchRequestModel.isRegEx,"onUpdate:modelValue":t[7]||(t[7]=e=>R.watchRequestModel.isRegEx=e),size:"large"},{open:(0,l.w5)((()=>[d])),close:(0,l.w5)((()=>[h])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})]),(0,l._)("div",null,[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"numberOfLimit"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{type:"number",modelValue:R.watchRequestModel.numberOfLimit,"onUpdate:modelValue":t[8]||(t[8]=e=>R.watchRequestModel.numberOfLimit=e),placeholder:"Enter numberOfLimit..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"6"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"excludeClassPattern"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{type:"text",modelValue:R.watchRequestModel.excludeClassPattern,"onUpdate:modelValue":t[9]||(t[9]=e=>R.watchRequestModel.excludeClassPattern=e),placeholder:"Enter excludeClassPattern..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"3"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"verbose"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{modelValue:R.watchRequestModel.verbose,"onUpdate:modelValue":t[10]||(t[10]=e=>R.watchRequestModel.verbose=e),size:"large"},{open:(0,l.w5)((()=>[r])),close:(0,l.w5)((()=>[m])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"9"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"maxNumOfMatchedClass"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{type:"number",modelValue:R.watchRequestModel.maxNumOfMatchedClass,"onUpdate:modelValue":t[11]||(t[11]=e=>R.watchRequestModel.maxNumOfMatchedClass=e),placeholder:"Enter maxNumOfMatchedClass..."},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})]),(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{type:"primary",onClick:x.watch,disabled:!this.watchEnable},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(this.submitText),1)])),_:1},8,["onClick","disabled"]),(0,l.Wm)(v,{style:{"margin-left":"8px"},onClick:x.stopWatchRequest},{default:(0,l.w5)((()=>[p])),_:1},8,["onClick"]),(0,l.Wm)(v,{style:{"margin-left":"8px"},onClick:x.clear},{default:(0,l.w5)((()=>[w])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),(0,l._)("table",null,[g,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(R.tableData,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{key:t},[(0,l._)("td",null,(0,a.zw)(e.jobId),1),(0,l._)("td",null,(0,a.zw)(e.resultId),1),(0,l._)("td",null,(0,a.zw)(e.ts),1),(0,l._)("td",null,(0,a.zw)(e.accessPoint),1),(0,l._)("td",null,(0,a.zw)(e.className),1),(0,l._)("td",null,(0,a.zw)(e.methodName),1),(0,l._)("td",null,(0,a.zw)(e.cost),1),(0,l._)("td",null,[(0,l.Wm)(I,{id:"tree",data:e.value},null,8,["data"])]),(0,l._)("td",null,[(0,l.Wm)(v,{type:"primary",onClick:t=>x.handleClick(e)},{default:(0,l.w5)((()=>[b])),_:2},1032,["onClick"])])])))),128))]),(0,l.Wm)(O,{modelValue:R.modal,"onUpdate:modelValue":t[14]||(t[14]=e=>R.modal=e),title:"信息查看",onOnCancel:x.modalCancel},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("JobId: "+(0,a.zw)(this.objectQueryModel.jobId),1)])),_:1}),(0,l.Wm)(S,{color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("resultId: "+(0,a.zw)(this.objectQueryModel.resultId),1)])),_:1}),(0,l.Wm)(V,null,{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{span:"12"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"express"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{modelValue:this.objectQueryModel.resultExpress,"onUpdate:modelValue":t[12]||(t[12]=e=>this.objectQueryModel.resultExpress=e),placeholder:"Enter express..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(W,{span:"12"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"expand"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{type:"number",modelValue:this.objectQueryModel.depth,"onUpdate:modelValue":t[13]||(t[13]=e=>this.objectQueryModel.depth=e),placeholder:"Enter conditionExpress..."},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,l.Wm)(v,{type:"warning",onClick:x.sendObjectRequest},{default:(0,l.w5)((()=>[f])),_:1},8,["onClick"]),M,(0,l.Wm)(I,{id:"treeInModal",data:this.treeData},null,8,["data"])])),_:1},8,["modelValue","onOnCancel"])])],64)}s(7658);var x=s(3378),q=s(2969),_={name:"watchView",components:{Col:q.Col},inject:["apiHost"],data(){return{watchClient:null,objectClient:null,modal:!1,objectQueryModel:{className:"demo.MathGame",classLoaderHash:0,classLoaderClass:"",express:"instances[0]",depth:2,limit:1,jobId:0,resultId:0,resultExpress:""},metadata:{},watchStream:null,changeWatchStream:null,isWatching:!1,submitText:"开始watch",watchEnable:!0,watchRequestModel:{classPattern:"demo.MathGame",methodPattern:"primeFactors",express:"{params, target, returnObj}",conditionExpress:"",isBefore:!1,isFinish:!0,isException:!1,isSuccess:!1,situation:"isFinish",expand:2,sizeLimit:10485760,isRegEx:!1,numberOfLimit:10,excludeClassPattern:"",listenerId:0,verbose:!1,maxNumOfMatchedClass:50,jobId:0},tableData:[],treeData:[]}},created(){let e=this.apiHost;this.watchClient=new x.WatchClient(e),this.objectClient=new x.ObjectServiceClient(e),this.metadata={"Content-Type":"application/grpc-web-text"}},methods:{modalCancel(){this.modal=!1},handleClick(e){this.objectQueryModel.className="com.taobao.arthas.grpcweb.grpc.service.GrpcJobController",this.objectQueryModel.resultExpress="{params, target, returnObj}",this.objectQueryModel.jobId=e.jobId,this.objectQueryModel.resultId=e.resultId,this.objectQueryModel.type=e.type,this.objectQueryModel.express="instances[0].{jobs}.get(0).get("+e.jobId+"L).{listener}.{results}.get(0).get("+e.resultId+"L)";let t=e.value[0],s=JSON.parse(JSON.stringify(t));this.treeData=[s],this.modal=!0},watch(){this.isWatching?this.changeWatchRequest():this.sendWatchRequest()},sendWatchRequest(){this.watchRequestModel.isBefore=!1,this.watchRequestModel.isFinish=!1,this.watchRequestModel.isSuccess=!1,this.watchRequestModel.isException=!1,"isBefore"==this.watchRequestModel.situation?this.watchRequestModel.isBefore=!0:"isFinish"==this.watchRequestModel.situation?this.watchRequestModel.isFinish=!0:"isSuccess"==this.watchRequestModel.situation?this.watchRequestModel.isSuccess=!0:this.watchRequestModel.isException=!0;const e=new x.WatchRequest;e.setClasspattern(this.watchRequestModel.classPattern).setMethodpattern(this.watchRequestModel.methodPattern).setExpress(this.watchRequestModel.express).setConditionexpress(this.watchRequestModel.conditionExpress).setIsbefore(this.watchRequestModel.isBefore).setIsfinish(this.watchRequestModel.isFinish).setIsexception(this.watchRequestModel.isException).setIssuccess(this.watchRequestModel.isSuccess).setExpand(this.watchRequestModel.expand).setSizelimit(this.watchRequestModel.sizeLimit).setIsregex(this.watchRequestModel.isRegEx).setNumberoflimit(this.watchRequestModel.numberOfLimit).setExcludeclasspattern(this.watchRequestModel.excludeClassPattern).setListenerid(this.watchRequestModel.listenerId).setVerbose(this.watchRequestModel.verbose).setMaxnumofmatchedclass(this.watchRequestModel.maxNumOfMatchedClass).setJobid(this.watchRequestModel.jobId),this.watchStream=this.watchClient.watch(e,{});let t=this;this.watchStream.on("data",(function(e){const s=e.getJobid(),l=e.getType(),a=e.getResultid();if("watch"==l&&e.hasWatchresponse()){t.isWatching=!0;const n=e.getWatchresponse();var i=t.getObject(n.getValue());i["expand"]=!0;var o={jobId:s,resultId:a,type:l,ts:n.getTs(),accessPoint:n.getAccesspoint(),className:n.getClassname(),methodName:n.getMethodname(),cost:n.getCost(),value:[i]};t.tableData.unshift(o),t.watchRequestModel.jobId=s,t.submitText="动态修改条件"}else console.log("收到的不是watchResponse: -----\x3e"),console.log("type:",l),console.log("message:",e.getStringvalue()),t.$Notice.info({title:"watch tips",desc:e.getStringvalue()})})),this.watchStream.on("status",(function(e){console.log("status.code "+e.code),console.log("status.details "+e.details),console.log("status.metadata "+e.metadata.toString())})),this.watchStream.on("end",(function(e){console.log("end: "+e),t.watchStream.cancel(),t.isWatching=!1,t.submitText="开始watch",t.$Notice.info({title:"watch结束",desc:"watch结束"})}))},changeWatchRequest(){this.watchRequestModel.isBefore=!1,this.watchRequestModel.isFinish=!1,this.watchRequestModel.isSuccess=!1,this.watchRequestModel.isException=!1,"isBefore"==this.watchRequestModel.situation?this.watchRequestModel.isBefore=!0:"isFinish"==this.watchRequestModel.situation?this.watchRequestModel.isFinish=!0:"isSuccess"==this.watchRequestModel.situation?this.watchRequestModel.isSuccess=!0:this.watchRequestModel.isException=!0;const e=new x.WatchRequest;e.setClasspattern(this.watchRequestModel.classPattern).setMethodpattern(this.watchRequestModel.methodPattern).setExpress(this.watchRequestModel.express).setConditionexpress(this.watchRequestModel.conditionExpress).setIsbefore(this.watchRequestModel.isBefore).setIsfinish(this.watchRequestModel.isFinish).setIsexception(this.watchRequestModel.isException).setIssuccess(this.watchRequestModel.isSuccess).setExpand(this.watchRequestModel.expand).setSizelimit(this.watchRequestModel.sizeLimit).setIsregex(this.watchRequestModel.isRegEx).setNumberoflimit(this.watchRequestModel.numberOfLimit).setExcludeclasspattern(this.watchRequestModel.excludeClassPattern).setListenerid(this.watchRequestModel.listenerId).setVerbose(this.watchRequestModel.verbose).setMaxnumofmatchedclass(this.watchRequestModel.maxNumOfMatchedClass).setJobid(this.watchRequestModel.jobId),this.changeWatchStream=this.watchClient.watch(e,{});let t=this;this.changeWatchStream.on("data",(function(e){const s=e.getJobid(),l=e.getType(),a=e.getResultid();"watch"!=l&&(console.log("jobId:",s),console.log("resultId:",a),console.log("message:",e.getStringvalue()),t.$Notice.info({title:"SUCCESS",desc:"修改成功"}))})),this.changeWatchStream.on("status",(function(e){console.log("status.code "+e.code),console.log("status.details "+e.details),console.log("status.metadata "+e.metadata.toString())})),this.changeWatchStream.on("end",(function(e){console.log("end: "+e),t.changeWatchStream.cancel()}))},stopWatchRequest(){this.isWatching&&null!=this.watchStream&&(this.watchStream.cancel(),this.isWatching=!1,this.$Notice.warning({title:"Notification",desc:"手动停止watch"})),this.submitText="开始watch"},clear(){this.tableData=[]},sendObjectRequest(){const e=new x.ObjectQuery;e.setClassname(this.objectQueryModel.className).setLimit(this.objectQueryModel.limit).setDepth(this.objectQueryModel.depth).setJobid(this.objectQueryModel.jobId).setResultid(this.objectQueryModel.resultId).setExpress(this.objectQueryModel.express).setResultexpress(this.objectQueryModel.resultExpress),this.objectClient.query(e,{},((e,t)=>{if(e)console.error(e);else{this.treeData=[],console.log("response",t),console.log("response.sucess",t.getSuccess()),console.log("response.message",t.getMessage());const e=t.getObjectsList();e.forEach((e=>{const t=this.getObject(e);t["expand"]=!0,this.treeData.push(t)}))}}))},getBasicvalue(e){const t={};let s,l;return e.hasInt()?(s=e.getInt(),l="java.lang.Integer"):e.hasLong()?(s=e.getLong(),l="java.lang.Long"):e.hasFloat()?(s=e.getFloat(),l="java.lang.Float"):e.hasDouble()?(s=e.getDouble(),l="java.lang.Double"):e.hasBoolean()?(s=e.getBoolean(),l="java.lang.Boolean"):e.hasString()&&(s=e.getString(),l="java.lang.String"),t["title"]=s+" (@"+l,t},getArrayElements(e){const t={};let s="element";try{s=e.getName()}catch(l){try{s=e.getClassname()}catch(l){console.log()}}if(e.hasObjectvalue())t["title"]=s+" (@Object",t["children"]=[],t["children"].push(this.getObject(e.getObjectvalue()));else if(e.hasBasicvalue()){const l=e.getBasicvalue();"element"==s||this.isBasicType(s)?t["title"]=this.getBasicvalue(l)["title"]:(t["title"]=s+" (@Basic",t["children"]=[],t["children"].push(this.getBasicvalue(l)))}else if(e.hasArrayvalue()){const l=e.getArrayvalue();t["title"]=s+" (@ArrayList",t["children"]=[];const a=l.getElementsList();a.forEach((e=>{t["children"].push(this.getArrayElements(e))}))}else e.hasNullvalue()?(t["title"]=s+" (@null",t["children"]=[],t["children"].push({title:"(null)"+e.getNullvalue().getClassname()})):e.hasUnexpandedobject()&&(t["title"]=s+" (@Unexpand",t["children"]=[],t["children"].push({title:" (Unexpand) "+e.getUnexpandedobject().getClassname()}));return t},getObject(e){const t={};let s="";try{s=e.getName()}catch(l){try{s=e.getClassname()}catch(l){console.log()}}if(e.hasObjectvalue())t["title"]=s+" (@Object",t["children"]=[],t["children"].push(this.getObject(e.getObjectvalue()));else if(e.hasBasicvalue()){const l=e.getBasicvalue();""==s||this.isBasicType(s)?t["title"]=this.getBasicvalue(l)["title"]:(t["title"]=s+" (@Basic",t["children"]=[],t["children"].push(this.getBasicvalue(l)))}else if(e.hasArrayvalue()){const l=e.getArrayvalue();t["title"]=s+" (@ArrayList",t["children"]=[];const a=l.getElementsList();a.forEach((e=>{t["children"].push(this.getArrayElements(e))}))}else if(e.hasNullvalue())t["title"]=s+" (@null",t["children"]=[],t["children"].push({title:"(@null)"+e.getNullvalue().getClassname()});else if(e.hasCollection()){t["title"]=s+" (@Collection",t["children"]=[];const l=e.getCollection().getElementsList();l.forEach((e=>{t["children"].push(this.getObject(e))}))}else if(e.hasMap()){t["title"]=s+" (@Map",t["children"]=[];const l=e.getMap().getEntriesList();l.forEach((e=>{const s={},l={},a={};s["title"]="Entry",s["children"]=[],l["title"]="key",l["children"]=[],l["children"].push(this.getObject(e.getKey())),s["children"].push(l),a["title"]="value",a["children"]=[],a["children"].push(this.getObject(e.getValue())),s["children"].push(a),t["children"].push(s)}))}else if(e.hasUnexpandedobject())t["title"]=s+" (@Unexpand",t["children"]=[],t["children"].push({title:" (@Unexpand) "+e.getUnexpandedobject().getClassname()});else if(e.hasFields()){t["title"]=s,t["children"]=[];const l=e.getFields().getFieldsList();l.forEach((e=>{t["children"].push(this.getObject(e))}))}return t},isBasicType(e){return"java.lang.String"==e||"java.lang.Integer"==e||"java.lang.Long"==e||"java.lang.Float"==e||"java.lang.Double"==e||"java.lang.Boolean"==e}}},W=s(89);const j=(0,W.Z)(_,[["render",R],["__scopeId","data-v-89249bde"]]);var y=j}}]);
//# sourceMappingURL=276.7018c180.js.map